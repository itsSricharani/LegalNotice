<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Analyze Legal Notice</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header class="top-bar">
    <div class="logo">
        <a href="index.html">
            <img src="logo.png" alt="Logo">
        </a>
    </div>
</header>

<main class="hero">
    <div class="hero-text">
        <h1>Analyze a Legal Notice</h1>

        <p>
            Paste the legal notice text below or upload a PDF document.
            The system will extract key information in simple language.
        </p>

        <textarea id="noticeText"
                  placeholder="Paste legal notice text here..."></textarea>

        <div class="file-input">
            <input type="file" id="pdfFile" accept=".pdf">
        </div>

        <!-- ONLY CHANGE: button now opens captcha -->
        <button class="primary-btn" onclick="openCaptcha()">Analyze</button>
    </div>

    <div class="hero-visual notice-image">
        <img src="comdoc.png" class="img-base">
        <img src="simdoc.png" class="img-hover">
    </div>
</main>

<section class="content">
    <div id="results" class="results hidden">
        <div class="result-box">
            <h3>Summary</h3>
            <p id="summary"></p>
        </div>
        <div class="result-box">
            <h3>Intent</h3>
            <p id="intent"></p>
        </div>
        <div class="result-box">
            <h3>Deadline</h3>
            <p id="deadline"></p>
        </div>
        <div class="result-box">
            <h3>Risk</h3>
            <p id="risk"></p>
        </div>
    </div>
</section>

<!-- CAPTCHA MODAL (NEW, isolated) -->
<div id="captchaOverlay" class="captcha-overlay">
    <div class="captcha-modal">
        <h3>Verify you are human</h3>

        <div id="captchaText" class="captcha-display"></div>

        <input
            type="text"
            id="captchaInput"
            placeholder="Enter the code"
        />

        <button onclick="validateCaptcha()">Verify</button>

        <p id="captchaResult" class="captcha-result"></p>
    </div>
</div>

<script>
let captcha = "";

/* OPEN CAPTCHA */
function openCaptcha() {
    document.getElementById("captchaOverlay").style.display = "flex";
    document.getElementById("captchaResult").innerText = "";
    document.getElementById("captchaInput").value = "";
    generateCaptcha();
}

/* GENERATE CAPTCHA */
function generateCaptcha() {
    captcha = Math.floor(1000 + Math.random() * 9000).toString();
    document.getElementById("captchaText").innerText = captcha;
}

/* VALIDATE CAPTCHA */
function validateCaptcha() {
    const userInput = document.getElementById("captchaInput").value.trim();

    if (userInput === captcha) {
        document.getElementById("captchaOverlay").style.display = "none";
        analyzeNotice();   // existing logic, untouched
    } else {
        document.getElementById("captchaResult").innerText =
            "Incorrect code. Please try again.";
        generateCaptcha();
    }
}
</script>

<script>
async function analyzeNotice() {
    const text = document.getElementById("noticeText").value.trim();
    const file = document.getElementById("pdfFile").files[0];

    let response;

    if (file) {
        const formData = new FormData();
        formData.append("file", file);

        response = await fetch("http://127.0.0.1:5000/analyze-pdf", {
            method: "POST",
            body: formData
        });
    } else if (text.length > 0) {
        response = await fetch("http://127.0.0.1:5000/analyze", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ text })
        });
    } else {
        alert("Please paste text or upload a PDF.");
        return;
    }

    const data = await response.json();

    document.getElementById("summary").innerText = data.summary || "Unknown";
    document.getElementById("intent").innerText = data.intent || "Unknown";
    document.getElementById("deadline").innerText = data.deadline || "Not found";
    document.getElementById("risk").innerText = data.risk || "Unknown";

    document.getElementById("results").classList.remove("hidden");
}
</script>

<script>
window.addEventListener("load", () => {
    document.body.classList.add("loaded");
});
</script>

</body>
</html>
