<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Analyze Legal Notice</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header class="top-bar">
    <div class="logo">
        
        <a href="index.html">
            <img src="logo.png" alt="Logo">
        </a>
    </div>
    <nav>
            <a href="index.html">Home</a>
            <a href="guidelines.html">Guidelines</a>
            <a href="safety.html">Safety</a>
        </nav>
</header>

<main class="hero">
    <div class="hero-text">
        <h1>Analyze a Legal Notice</h1>

        <p>
            Paste the legal notice text below or upload a PDF document.
            The system will extract key information in simple language.
        </p>

        <textarea id="noticeText"
                  placeholder="Paste legal notice text here..."></textarea>

        <div class="file-input">
            <input type="file" id="pdfFile" accept=".pdf" onchange="onFileSelected()">
            <button
                type="button"
                id="removeFileBtn"
                class="remove-file-btn"
                onclick="clearSelectedFile()"
                style="display:none;"
            >
                Remove Selected File
            </button>
        </div>


        
        <button class="primary-btn" onclick="openCaptcha()">Analyze</button>
    </div>

    <div class="hero-visual notice-image">
        <img src="comdoc.png" class="img-base">
        <img src="simdoc.png" class="img-hover">
    </div>
</main>

<section class="content">
    <div id="results" class="results hidden">
        <div class="result-box">
            <h3>Summary</h3>
            <p id="summary"></p>
        </div>
        <div class="result-box">
            <h3>Intent</h3>
            <p id="intent"></p>
        </div>
        <div class="result-box">
            <h3>Deadline</h3>
            <p id="deadline"></p>
        </div>
        <div class="result-box">
            <h3>Risk</h3>
            <p id="risk"></p>
        </div>
    </div>
</section>

<
<div id="captchaOverlay" class="captcha-overlay">
    <div class="captcha-modal">
        <h3>Verify you are human</h3>

        <div id="captchaText" class="captcha-display"></div>

        <input
            type="text"
            id="captchaInput"
            placeholder="Enter the code"
        />

        <button onclick="validateCaptcha()">Verify</button>

        <p id="captchaResult" class="captcha-result"></p>
    </div>
</div>

<script>
let captcha = "";


function openCaptcha() {
    document.getElementById("captchaOverlay").style.display = "flex";
    document.getElementById("captchaResult").innerText = "";
    document.getElementById("captchaInput").value = "";
    generateCaptcha();
}

function generateCaptcha() {
    captcha = Math.floor(1000 + Math.random() * 9000).toString();
    document.getElementById("captchaText").innerText = captcha;
}


function validateCaptcha() {
    const userInput = document.getElementById("captchaInput").value.trim();
    

    if (userInput === captcha) {
        document.getElementById("captchaOverlay").style.display = "none";
        const loading = document.getElementById("loadingOverlay");
        loading.style.display = "flex";
        startLoadingPhrases();
        analyzeNotice();   

    } else {
        document.getElementById("captchaResult").innerText =
            "Incorrect code. Please try again.";
        generateCaptcha();
    }
}
</script>

<script>
async function analyzeNotice() {
    const text = document.getElementById("noticeText").value.trim();
    const file = document.getElementById("pdfFile").files[0];

    try {
        let response;

        if (file) {
            const formData = new FormData();
            formData.append("file", file);

            response = await fetch("http://127.0.0.1:5000/analyze-pdf", {
                method: "POST",
                body: formData
            });

        } else if (text.length > 0) {
            response = await fetch("http://127.0.0.1:5000/analyze", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ text })
            });

        } else {
            alert("Please paste text or upload a PDF.");
            return;
        }

        const data = await response.json();
        sessionStorage.setItem("analysisResult", JSON.stringify(data));
        window.location.href = "results.html";

    } catch (error) {
        alert("Something went wrong while analyzing. Please try again.");
        console.error(error);

    } finally {
        document.getElementById("loadingOverlay").style.display = "none";
        stopLoadingPhrases();
    }
}
</script>


<script>
window.addEventListener("load", () => {
    document.body.classList.add("loaded");
});
</script>

<div id="loadingOverlay" class="loading-overlay">
    <div class="loading-modal">
        <div class="loading-icons">
            
            <span class="loading-icon">üîç</span>
            <span class="loading-icon">‚ö°</span>
             <span class="loading-icon">üìú</span>
            <span class="loading-icon">‚öôÔ∏è</span>
            
            
            
        </div>
        <p id="loadingPhrase">Analyzing your document...</p>
    </div>
</div>
<script>
    const phrases = [
        "Analyzing your document...",
        "Checking for inconsistencies...",
        "Summarizing key points...",
        "Almost there...",
        "Preparing your results..."
    ];

    let phraseIndex = 0;
    let phraseInterval;

    function startLoadingPhrases() {
        const phraseEl = document.getElementById("loadingPhrase");
        phraseInterval = setInterval(() => {
            phraseIndex = (phraseIndex + 1) % phrases.length;
            phraseEl.innerText = phrases[phraseIndex];
        }, 1500); 
    }

    function stopLoadingPhrases() {
        clearInterval(phraseInterval);
    }
</script>

<script>
function onFileSelected() {
    const fileInput = document.getElementById("pdfFile");
    const removeBtn = document.getElementById("removeFileBtn");

    if (fileInput.files.length > 0) {
        removeBtn.style.display = "inline-block";
    }
}

function clearSelectedFile() {
    const fileInput = document.getElementById("pdfFile");
    const removeBtn = document.getElementById("removeFileBtn");

    fileInput.value = "";          // clears the file
    removeBtn.style.display = "none";
}
</script>


</body>
</html>
